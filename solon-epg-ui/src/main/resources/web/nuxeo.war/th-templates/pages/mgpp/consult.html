<!DOCTYPE html>

<html
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:th="http://www.thymeleaf.org"
    th:replace="~{layouts/layout  :: layout (template=~{::main},templateClass='', description='consultation communication',title=${titreDossier})}"
>
    <main role="main" id="main_content" class="page-layout__content notif-evenement">
        <input type="hidden" id="dossierId" name="dossierId" th:value="${idDossier}" />
        <input type="hidden" id="idMessage" name="idMessage" th:value="${idMessage}" />
        <input type="hidden" id="ficheId" name="ficheId" th:value="${idFiche}" />
        <input type="hidden" id="urlPreviousPage" name="urlPreviousPage" th:value="@{${urlPreviousPage}}" />

        <div id="consult_dossier_content">
            <div class="page-layout__content-nav">
                <button
                    type="button"
                    class="base-btn base-btn--button base-btn--default base-btn--light base-btn--bordered"
                    onclick="goPreviousPage()"
                    th:text="#{button.label.back}"
                    th:if="${not #strings.isEmpty(urlPreviousPage)}"
                ></button>
            </div>

            <div class="heading-complex">
                <div th:if="${monDossier!=null}" class="heading-complex__main">
                    <h1 class="heading-complex__title base-title base-title--lvl-1">[[${monDossier.titreActe}]]</h1>
                    <div
                        th:unless="${#strings.isEmpty(monDossier.numeroNor)}"
                        class="heading-complex__subtitle base-subtitle"
                    >
                        -
                        <th:block
                            th:replace="fragments/components/idComponent :: id('consult_link-copy__link', ${monDossier.numeroNor}, 'NOR', null, false, true)"
                        ></th:block>
                    </div>
                </div>
                <div class="heading-complex__options">
                    <th:block th:each="action : ${lockActions}">
                        <div
                            th:replace="fragments/components/action-button :: action-button(${action}, false, 'base-btn--icon-action-blue base-btn--transparent')"
                        ></div>
                    </th:block>
                    <p
                        th:if="${monDossier!=null && monDossier.isVerrouille}"
                        th:text="#{dossier.consult.lockinfo(${monDossier.lockTime},${monDossier.lockOwner})}"
                    ></p>
                </div>
            </div>

            <div th:if="${message != null}" class="page-layout__title-icon flex justify-between m-t-7 m-b-5">
                <h2 class="flex-1 base-title base-title--lvl-1">
                    [[${message.communication}]] - [[${message.idDossier}]] - [[${message.objetDossier}]]
                </h2>
                <div class="p-l-9 p-t-1 whitespace-no-wrap">
                    <div
                        tabindex="0"
                        class="base-tooltip js-tooltip"
                        th:data-tippy-content="#{'label.mgpp.etat.'+${message.etatMessage}}"
                    >
                        <span
                            th:if="${message.etatMessage == 'NON_TRAITE'}"
                            aria-hidden="true"
                            class="icon icon--stop-circle text-blue icon--big"
                        ></span>
                        <span
                            th:if="${message.etatMessage == 'EN_COURS_TRAITEMENT'}"
                            aria-hidden="true"
                            class="icon icon--arrow-triangle-right-circle text-blue icon--big"
                        ></span>
                        <span
                            th:if="${message.etatMessage == 'TRAITE'}"
                            aria-hidden="true"
                            class="icon icon--check-circle text-blue icon--big"
                        ></span>
                        <span
                            th:if="${message.etatMessage == 'EN_COURS_REDACTION'}"
                            aria-hidden="true"
                            class="icon icon--pen-circle text-blue icon--big"
                        ></span>
                        <span
                            th:if="${message.etatMessage == 'EN_ATTENTE_AR'}"
                            aria-hidden="true"
                            class="icon icon--pause-circle text-blue icon--big"
                        ></span>
                        <span
                            th:if="${message.etatMessage == 'EMIS'}"
                            aria-hidden="true"
                            class="icon icon--arrow-right-circle text-blue icon--big"
                        ></span>
                        <span
                            th:if="${message.etatMessage == 'AR_RECU'}"
                            aria-hidden="true"
                            class="icon icon--mail text-blue icon--big"
                        ></span>
                        <span
                            th:if="${message.etatMessage == 'AR_RECU_VERSION_REJETE'}"
                            aria-hidden="true"
                            class="icon icon--mail text-blue icon--big"
                        ></span>
                        <span class="sr-only" th:text="#{'label.mgpp.etat.'+${message.etatMessage}}"></span>
                    </div>
                    <div
                        tabindex="0"
                        class="base-tooltip js-tooltip m-l-4"
                        th:data-tippy-content="#{'label.mgpp.etat.'+${message.etatEvenement}}"
                    >
                        <span
                            th:if="${message.etatEvenement == 'BROUILLON'}"
                            aria-hidden="true"
                            class="icon icon--paper text-blue icon--big"
                        ></span>
                        <span
                            th:if="${message.etatEvenement == 'PUBLIE'}"
                            aria-hidden="true"
                            class="icon icon--paper-bubble-triangle-right text-blue icon--big"
                        ></span>
                        <span
                            th:if="${message.etatEvenement == 'EN_INSTANCE'}"
                            aria-hidden="true"
                            class="icon icon--paper-bubble-check text-blue icon--big"
                        ></span>
                        <span
                            th:if="${message.etatEvenement == 'EN_ATTENTE_DE_VALIDATION'}"
                            aria-hidden="true"
                            class="icon icon--paper-bubble-clock text-blue icon--big"
                        ></span>
                        <span
                            th:if="${message.etatEvenement == 'EN_ATTENTE_VALIDATION_ANNULATION'}"
                            aria-hidden="true"
                            class="icon icon--paper-bubble-clock text-blue icon--big"
                        ></span>
                        <span
                            th:if="${message.etatEvenement == 'ANNULE'}"
                            aria-hidden="true"
                            class="icon icon--paper-bubble-times text-blue icon--big"
                        ></span>
                        <span class="sr-only" th:text="#{'label.mgpp.etat.'+${message.etatEvenement}}"></span>
                    </div>
                </div>
            </div>

            <div class="page-reponses-qe-base__steps m-t-3">
                <p class="m-y-0 base-paragraph" th:if="${currentStep != null}">
                    [[#{label.mgpp.dossier.etape.enCours}]]
                    <strong><span th:each="label: ${currentStep}" th:text="${label}"></span></strong>
                </p>
                <p class="m-y-0 m-l-4 base-paragraph" th:if="${nextStep != null}">
                    [[#{label.mgpp.dossier.etape.aVenir}]]
                    <strong><span th:each="label: ${nextStep}" th:text="${label}"></span></strong>
                </p>
            </div>

            <div th:replace="fragments/table/toolbar :: toolbar('dossier_toolbar_before', false)"></div>

            <div class="m-t-5">
                <div th:if="${myTabs!=null}" class="tabulation">
                    <div role="tablist" class="tabulation__header">
                        <button
                            th:each="onglet, status : ${myTabs.onglets}"
                            type="button"
                            role="tab"
                            class="tabulation__item js-tabulation base-btn base-btn--button base-btn--default base-btn--transparent dossier-onglet dossier-onglet-mgpp"
                            th:classappend="${onglet.isActif ? 'tabulation\_\_item--active' : ''}"
                            th:aria-selected="${onglet.isActif ? 'true' : 'false'}"
                            th:aria-controls="'d_tab_content-'+${status.index}"
                            th:id="'d_tab_link-'+${status.index}"
                            th:data-script="${onglet.script}"
                            th:data-name="${onglet.id}"
                            onclick="javascript:eval(this.getAttribute('data-script'))"
                            th:tabindex="${!onglet.isActif ? '-1' : null}"
                            th:text="#{__${onglet.label}__}"
                        ></button>
                    </div>
                    <div class="tabulation__body">
                        <div
                            th:each="onglet, status : ${myTabs.onglets}"
                            role="tabpanel"
                            tabindex="0"
                            class="tabulation__content"
                            th:id="'d_tab_content-'+${status.index}"
                            th:aria-hidden="${onglet.isActif ? 'false' : 'true'}"
                            th:aria-labelledby="'d_tab_link--'+${status.index}"
                            th:classappend="${onglet.isActif ? 'tabulation\_\_content--active' : ''}"
                        >
                            <th:block th:if="${onglet.isActif}">
                                <div th:replace="${onglet.fragmentFile} :: ${onglet.fragmentName}"></div>
                            </th:block>
                            <div th:unless="${onglet.isActif}" th:id="'d_'+${onglet.id}+'_content'"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div th:replace="fragments/table/toolbar :: toolbar('dossier_toolbar_after', false)"></div>

            <div class="page-layout__content-nav is-bellow">
                <button
                    type="button"
                    class="base-btn base-btn--button base-btn--default base-btn--light base-btn--bordered"
                    onclick="goPreviousPage()"
                    th:text="#{button.label.back}"
                    th:if="${not #strings.isEmpty(urlPreviousPage)}"
                ></button>
            </div>

            <!-- Modale de confirmation de déverouillage -->
            <input
                type="hidden"
                id="init-modal-deverouillage"
                th:data-title="${#messages.msg('deverouillage.title.label')}"
                th:data-message="${#messages.msg('deverouillage.modal.confirm.question')}"
                th:data-btn-confirm-label="${#messages.msg('button.confirmer')}"
                data-function="deverouilleDossier()"
                data-controls="validation-dialog-modal"
            />
        </div>
    </main>
</html>
